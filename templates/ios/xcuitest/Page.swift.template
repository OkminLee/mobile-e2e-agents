//
//  {{PAGE_NAME}}Page.swift
//  {{PROJECT_NAME}}UITests
//
//  Page Object for {{PAGE_NAME}} screen
//  Generated by mobile-e2e-agents
//

import XCTest

/// Page Object representing the {{PAGE_NAME}} screen
///
/// Usage:
/// ```swift
/// let page = {{PAGE_NAME}}Page(app: app)
/// page.verify{{PAGE_NAME}}Displayed()
/// page.tap{{PRIMARY_ACTION}}()
/// ```
final class {{PAGE_NAME}}Page: BasePage {

    // MARK: - Element Identifiers

    private enum Identifier {
        static let screen = "{{SCREEN_ID}}"
        // TODO: Add element identifiers
        // static let titleLabel = "{{screen_id}}_label_title"
        // static let submitButton = "{{screen_id}}_button_submit"
    }

    // MARK: - Elements

    /// Main screen container
    var screenContainer: XCUIElement {
        app.otherElements[Identifier.screen]
    }

    // TODO: Add UI elements
    // var titleLabel: XCUIElement {
    //     app.staticTexts[Identifier.titleLabel]
    // }
    //
    // var submitButton: XCUIElement {
    //     app.buttons[Identifier.submitButton]
    // }

    // MARK: - Verification

    /// Verify {{PAGE_NAME}} screen is displayed
    @discardableResult
    func verifyScreenDisplayed(timeout: TimeInterval = Timeout.medium) -> Bool {
        // Try screen container first
        if screenContainer.waitForExistence(timeout: timeout) {
            return true
        }

        // Fallback: check for any distinctive element
        // return titleLabel.waitForExistence(timeout: timeout)
        return false
    }

    // TODO: Add verification methods
    // @discardableResult
    // func verifyTitleText(_ expected: String) -> Self {
    //     XCTAssertEqual(titleLabel.label, expected)
    //     return self
    // }

    // MARK: - Actions

    // TODO: Add action methods
    // @discardableResult
    // func tapSubmitButton() -> NextPage {
    //     submitButton.safeTap()
    //     return NextPage(app: app)
    // }

    // MARK: - Queries

    // TODO: Add query methods
    // func hasError() -> Bool {
    //     errorLabel.exists
    // }
}

// MARK: - BasePage

/// Base class for all Page Objects
class BasePage {
    let app: XCUIApplication

    init(app: XCUIApplication) {
        self.app = app
    }

    /// Find element by accessibility identifier using descendants
    func element(matching identifier: String) -> XCUIElement {
        app.descendants(matching: .any)[identifier]
    }

    /// Find button by accessibility identifier
    func button(_ identifier: String) -> XCUIElement {
        app.buttons[identifier]
    }

    /// Find text field by accessibility identifier
    func textField(_ identifier: String) -> XCUIElement {
        app.textFields[identifier]
    }

    /// Find static text by accessibility identifier
    func staticText(_ identifier: String) -> XCUIElement {
        app.staticTexts[identifier]
    }

    /// Find switch by accessibility identifier
    func toggle(_ identifier: String) -> XCUIElement {
        app.switches[identifier]
    }

    /// Find cell by accessibility identifier
    func cell(_ identifier: String) -> XCUIElement {
        app.cells[identifier]
    }

    /// Wait for effects to settle
    func waitForEffectsToSettle(timeout: TimeInterval = 0.3) {
        Thread.sleep(forTimeInterval: timeout)
    }

    /// Capture screenshot with name
    func captureScreenshot(name: String) {
        let screenshot = XCUIScreen.main.screenshot()
        let attachment = XCTAttachment(screenshot: screenshot)
        attachment.name = name
        attachment.lifetime = .keepAlways
        XCTContext.runActivity(named: "Screenshot: \(name)") { activity in
            activity.add(attachment)
        }
    }
}
